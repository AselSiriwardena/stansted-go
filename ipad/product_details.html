<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Place details</title>

    <!-- jQuery mobile files -->
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>


    <!-- Font awesome file -->
    <script src="https://kit.fontawesome.com/f083cf2118.js" crossorigin="anonymous"></script>

    <!-- Bootstrap CSS file -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Custom main CSS file -->
    <link rel="stylesheet" href="index.css">

    <!--Normal API key -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<!--    With Marker-->
    <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1qVGFzRPQQ1Ii5v78fJ5q0OsIUaBobUM&callback=initMap&libraries=places&v=weekly"
            defer
    ></script>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="assets/css/slider_style.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/responsiveslides.css" />
    <script src="scripts/jquery-3.2.1.min.js"></script>
    <script src="scripts/responsiveslides.min.js"></script>
    <script>
        $(function () {
            $("#slider").responsiveSlides({
                auto: false,
                pager: false,
                nav: true,
                speed: 500,
                namespace: "slider-callback",
                maxwidth: "550px"
            });

        });
    </script>

    <!--custom css and js files -->
    <link rel="stylesheet" type="text/css" href="assets/css/map_style.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/rating_style.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/card_style.css" />
    <script src="scripts/map.js"></script>


</head>

<body class="post-login">
    <div data-role="page" class="productDetails">
        <div data-role="header" id="header">
            <div class="container">
                <div class="ui-grid-a">
                    <div class="ui-block-a w10">
                        <div class="ui-grid-a">
                            <div class="container">
                                <div class="ui-block-a w10">
                                    <a data-rel="back" rel="external"><img src="assets/img/back.svg" height="30"
                                            width="30"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-block-b icons w90">
                        <i class="fas fa-share-alt"></i>
                        <i id="favourite"></i>
                    </div>

                </div>
                <div class="ui-grid-a pl-4 mt-3">
                    <div class="ui-block-a w60 prod-deets">
                        <h3 id="productTitle">Big Ben Tower</h3>
                        <div class="ui-grid-a">
                            <div class="ui-block-a w40">
                                <i id="star1" class="fa fa-star secondary-color-yellow-text"></i>
                                <i id="star2" class="fa fa-star secondary-color-yellow-text"></i>
                                <i id="star3" class="fa fa-star secondary-color-yellow-text"></i>
                                <i id="star4" class="fa fa-star secondary-color-yellow-text"></i>
                                <i id="star5" class="fa fa-star-o secondary-color-yellow-text"></i>
                            </div>
                            <div class="ui-block-b w60">
                                <a rel="external">
                                    <p class="fw-bold f16" style="color: white" >58 Reviews</p>
                                </a>
                            </div>
                            <div class="ui-block-b icons w95">
                                <div class="responsive-slider">
                                    <ul class="rslides" id="slider">
                                        <li>
                                            <video width="100%" height="100%" controls><source src="https://firebasestorage.googleapis.com/v0/b/ui-ux-b3439.appspot.com/o/Videos%2Fvideoplayback.mp4?alt=media&token=8b7813d9-1150-470e-9f3c-66fb669dad47" type="video/mp4"></video>
                                        </li>
                                        <li>
                                            <img src="assets/images/bigbenslider.jfif" alt="">
                                            <p class="caption">Travel</p>
                                        </li>
                                        <li>
                                            <img src="assets/images/bigbenslider1.jfif" alt="">
                                            <p class="caption">Explore</p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        <p class="primary-color-grey-text f16 w95" id="productDetails">
                            Big Ben, situated at the Palace of Westminster, is one of the best known icons of London, and has been voted the Most Iconic Film Location in London. The clock, on its own, has been working since May 1859.
                        </p>
                            <hr class="rounded w95" >
                        <h3 class="primary-color-red-text"><b>Euro 10.99</b>
                        </h3>
                            <div class="ui-block-b icons w90">
                            </div>

                        </div>
                        <div class="ui-block-b w95">
                            <div class="card">
                                <div class="ui-grid-a">
                                    <div class="ui-block-b w100 pl-2">
                                        <div class="ui-grid-a">
                                            <div class="ui-block-a w40">
                                                <h4 style="line-height: 1.5;" class="black"><b>Jane Doe</b></h4>
                                            </div>
                                            <div style="color: #E2C224;" class="ui-block-b w60 text-right">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                            </div>
                                        </div>
                                        <div class="review-content pt-2">
                                            <p style="word-wrap: break-word;" class="primary-color-black text f16 text-justify">
                                                One of the most famous and important London landmarks since the past, the most famous measure of time and age of the watch, I think a century and a half...</p>
                                        </div>
                                        <div class="ui-grid-a">
                                            <div class="ui-block-a">
                                                <h6 class="primary-color-grey-text f16 fw-bold">2 Days ago</h6>
                                            </div>
                                            <div class="ui-block-a w50 d-flex align-items-center">
                                                <a href="comments.html" class=" p-0 m-0" data-transition="slide" rel="external">
                                                    <img height="auto" src="assets/images/comments.svg" width="20">
                                                </a>
                                            </div>
                                            <div class="ui-block-b f16 text-right">
                                                <i class="far fa-heart"></i> 57
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui-grid-a d-none hideInStore">
                                <a href="reviews.html" rel="external" class="ui-btn btn secondary-btn mb-3 w100 pathUrl"
                                       accesskey="proceed">Show All Reviews<span id = "review_count">(0)</span></a>
                            </div>
                        </div>

                        <div class="ui-grid-a pt-3">

                        </div>
                    </div>
                    <div class="ui-block-b w40 ">
                        <div class="card py-0 px-0">
                            <div id="map"></div></div>
                        <hr class="rounded w95" >
                        <div class="text-center h40">
                            <div id="row">
                            </div>
                            <div class="ui-grid-a pt-3">
                                <div class="ui-block-b">

                                </div>
                            </div>
                                <div class="ui-grid-a d-none hideInStore">
                                    <div class="ui-block-a w100">
                                        <a rel="external" class="ui-btn btn secondary-btn mb-3 w95 pathUrl"
                                           accesskey="proceed">Book Ticket</a>
                                    </div>
                        </div>
                                <div class="ui-grid-a d-none hideInStore">
                                    <div class="ui-block-b w100">
                                        <a rel="external" href="gamification_intro.html" class="ui-btn btn primary-btn mb-3 w95 pathUrl"
                                           accesskey="proceed">PLAY</a>
<!--                                        <a accesskey="proceed" rel="external" href="viewinAR.html" class="ui-btn btn secondary-btn mb-3 w95 pathUrl">VIEW IN AR</a>-->
                                    </div>

                    </div>
                            <div class="ui-grid-a d-none hideInStore">
                                <div class="ui-block-a w100">
                                    <a accesskey="proceed" rel="external" href="viewinAR.html" class="ui-btn btn secondary-btn mb-3 w95 pathUrl">VIEW IN AR</a>
                                </div>

                            </div>
                            <hr class="rounded w95" >
                        <div class="rating">
                            <div class="rating__number"><span id="rating_value">5.0</span></div>
                            <div class="rating__stars">
                                <div class="rating__stars-line">
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                </div>
                                <div class="rating__stars-line">
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>

                                </div>
                                <div class="rating__stars-line">
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>

                                </div>
                                <div class="rating__stars-line">
                                    <i class="fas fa-star rating__star"></i>
                                    <i class="fas fa-star rating__star"></i>

                                </div>
                                <div class="rating__stars-line">
                                    <i class="fas fa-star rating__star"></i>

                                </div>
                            </div>
                            <div id="ratingBars" class="rating__bars">
                                <div id ="bar1" class="rating__bar rating__bar--1">

                                </div>
                                <div id ="bar2" class="rating__bar rating__bar--2"></div>
                                <div id ="bar3" class="rating__bar rating__bar--3"></div>
                                <div id ="bar4" class="rating__bar rating__bar--4"></div>
                                <div id ="bar5" class="rating__bar rating__bar--5"></div>
                            </div>
                            </div>
                </div>

            </div>
        </div>
        <div data-role="main" >
            <div class="container">
                <div class="ui-grid-a">
                    <div class="ui-grid-solo mt-5">
                        <h3 class="primary-color-black-text fw-bold f22">Simmilar places</h3>
                        <div class="carousell">
                            <div class="item">
                                <div class="ui-grid-solo text-center">
                                    <div class="card">
                                        <div class="img-best mt-3 mb-3">
                                            <img src="assets/images/cornwall.jpg" width="100%">
                                        </div>
                                        <h3 class="pt-3">Cornwall</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="item">
                                <div class="ui-grid-solo text-center">
                                    <div class="card">
                                        <div class="img-best mt-3 mb-3">
                                            <img src="assets/images/Big Ben.jpg" width="100%">
                                        </div>
                                        <h3 class="pt-3">Big Ben</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="item">
                                <div class="ui-grid-solo text-center">
                                    <div class="card">
                                        <div class="img-best mt-3 mb-3">
                                            <img src="assets/images/Big Ben.jpg" width="100%">
                                        </div>
                                        <h3 class="pt-3">Colin</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="item">
                                <div class="ui-grid-solo text-center">
                                    <div class="card">
                                        <div class="img-best mt-3 mb-3">
                                            <img src="assets/images/cornwall.jpg" width="100%">
                                        </div>
                                        <h3 class="pt-3">Colin</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="item">
                                <div class="ui-grid-solo text-center">
                                    <div class="card">
                                        <div class="img-best mt-3 mb-3">
                                            <img src="assets/images/cornwall.jpg" width="100%">
                                        </div>
                                        <h3 class="pt-3">Colin</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-block-a pt-5 pl-4 mt-2 d-none hideInStore">
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script>
        $(document).ready(function () {

            $("#added").on("click", function () {
                $("#addedPop").popup("open");
                setTimeout(function () {
                    $("#addedPop").popup("close");
                }, 2000);
            });

            if (sessionStorage.getItem("currentDeal") === "2") {
                $(".showInStore").removeClass("d-none");

            } else {
                $(".hideInStore").removeClass("d-none");
            }


            $(document).on("click", ".dealsClick", function () {
                sessionStorage.setItem("currentDeal", this.accessKey);
                sessionStorage.setItem("ratingFilter", '0');
                sessionStorage.setItem("priceFilter", '{"startValue":"0","EndValue":"999"}');
                sessionStorage.setItem("sort", 'default');
                document.location.href = 'promotion_details.html';
            });
            quantity = 1;
            var thisimage;
            var prodId;

            $.post("backend/singleProduct.php", {
                currentProduct: sessionStorage.getItem("currentProduct")
            }, function (data, status) {
                data = JSON.parse(data);
                $.each(data, function (i, v) {
                    prodId = v.id;
                    thisimage = v.image;
                    $('#productTitle').text(v.name);
                    $('#productDetails').text(v.details);
                    $('#price').text(' ' + v.price);
                    $("#image").attr("src", v.image);
                });
            });

            $(".count").text("1");


            $(".plusCount").bind("click", function (event, ui) {
                quantity += 1;
                $(".count").text(quantity.toString());
            });

            $(".minusCount").bind("click", function (event, ui) {
                quantity -= 1;
                if (parseInt(quantity) > 0) {
                    $(".count").text(quantity.toString());
                } else {
                    quantity = 1;
                    $(".count").text(quantity.toString());
                }
            });
            var alreadyCart = false;
            var index;
            $(".pathUrl").click(function () {
                if (sessionStorage.getItem("currentDeal") === "2") {
                    document.location.href = this.accessKey;
                }
                var currentCart = JSON.parse(sessionStorage.getItem('cart'));
                $.each(currentCart['items'], function (i, item) {
                    if (item['id'] === prodId) {
                        alreadyCart = true;
                        index = i;
                        return false;
                    }
                });
                if (alreadyCart) {
                    currentCart['total'] = (parseFloat(currentCart['total']) - (parseFloat(currentCart[
                        'items'][index]['amount']) * parseFloat(currentCart['items'][index][
                        'price'
                    ]))).toFixed(2);
                    currentCart['items'][index]['amount'] = quantity;
                    currentCart['total'] = (parseFloat(currentCart['total']) + (parseFloat(currentCart[
                        'items'][index]['amount']) * parseFloat(currentCart['items'][index][
                        'price'
                    ]))).toFixed(2);
                    sessionStorage.setItem('cart', JSON.stringify(currentCart));
                } else {
                    var thisItem = {};
                    thisItem['image'] = thisimage;
                    thisItem['id'] = prodId;
                    thisItem['name'] = $('#productTitle').text();
                    thisItem['price'] = $('#price').text();
                    thisItem['amount'] = quantity;
                    currentCart['total'] = (parseFloat(currentCart['total']) + (parseFloat(thisItem[
                        'amount']) * parseFloat(thisItem['price']))).toFixed(2);
                    currentCart['items'].push(thisItem);
                    sessionStorage.setItem('cart', JSON.stringify(currentCart));
                }

                if (this.accessKey === 'proceed') {
                    document.location.href = "cart.html";
                } else if (this.accessKey === 'reviews') {
                    document.location.href = "reviews.html";
                } else {

                }

            });
            $.post("backend/userData.php", {
                action: 'view',
                currentUser: sessionStorage.getItem("loggedUser")
            }, function (data, status) {
                const json = JSON.parse(data);
                const favArray = json.favoriteList;
                const parseProductNo = parseInt(sessionStorage.getItem("currentProduct"));
                if (jQuery.inArray(parseProductNo, favArray) !== -1) {
                    const heart = `fas fa-heart primary-color-red-text pointer removeClick`;
                    $("#favourite").addClass(heart);

                } else {
                    const heart = `far fa-heart pointer addClick`;
                    $("#favourite").addClass(heart);
                }

            });
            $(document).on("click", ".addClick", function () {
                const that = this;
                $.post("backend/favourite.php", {
                    action: 'add',
                    currentUser: sessionStorage.getItem("loggedUser"),
                    prodId: sessionStorage.getItem("currentProduct")
                }, function (data, status) {
                    $(that).removeClass('far fa-heart pointer addClick');
                    $(that).addClass('fas fa-heart primary-color-red-text pointer removeClick');
                });
            });
            $(document).on("click", ".removeClick", function () {
                const that = this;
                $.post("backend/favourite.php", {
                    action: 'remove',
                    currentUser: sessionStorage.getItem("loggedUser"),
                    prodId: sessionStorage.getItem("currentProduct")
                }, function (data, status) {
                    $(that).removeClass(
                        'fas fa-heart primary-color-red-text pointer removeClick');
                    $(that).addClass('far fa-heart pointer addClick');
                });
            });
        })
    </script>
        <script src="scripts/rating_process.js"></script>
</body>

</html>
